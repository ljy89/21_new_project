<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="SubjectDAO">

	<!-- 전공 과목 조회 이름으로 정렬-->
	<select id="getMajorList" resultType="subject">
		SELECT s.name subname, p.name pname, s.time time, d.name dname
		FROM subject s, professor p, department d
		WHERE s.majoryn = 'y'
		AND s.dseq = d.dseq
		AND p.id = s.id
		ORDER BY s.name DESC
	</select>
	

	<!-- 교양과목 조회 이름으로 정렬 -->
	<select id="getLiberalArtsList" resultType="subject">
		SELECT s.name subname, p.name pname, s.time time, d.name dname
		FROM subject s, professor p, department d
		WHERE s.majoryn = 'n'
		AND s.dseq = d.dseq
		AND p.id = s.id
		ORDER BY s.name DESC
	</select>
	
	<!-- 상세페이지 -->
	<select id="getSubject" resultType="subject">
		SELECT s.name subname, p.name pname, s.content, s.time, s.location, d.name dname
		FROM subject s, professor p, department d
		WHERE sseq=#{sseq}
		AND s.dseq = d.dseq
		AND p.id = s.id
	</select>
	
	<!-- 교수명, 과목명으로 검색했을때 결과 -->
	<select id="searchSubjectList" resultType="subject">
		SELECT s.name subname, p.name pname, s.time, d.name dname
		FROM subject s, professor p, department d
		
		WHERE s.dseq = d.dseq
		AND p.id = s.id
		AND d.dseq = s.dseq
		AND p.name LIKE '%'||#{pname} ||'%'
		AND s.name LIKE '%'||#{subname} ||'%' 
		ORDER BY s.name DESC
	
	</select>
	<!-- 수업 추가 -->
	
	<insert id="insertSubject">
		INSERT INTO subject(sseq, name, id, time, majoryn, content, dseq, location)
		VALUES(subject_seq.NEXTVAL, #{subname}, #{pid}, #{time}, #{majoryn}, #{content}, #{dseq}, #{location})
	</insert>
	
	<!-- 수업 수정 -->
	<update id="updateSubject">
		UPDATE subject 
		SET name= #{subname}, id=#{pid} , time =#{time}, majoryn =#{majoryn}, content =#{content} , 
			dseq=#{dseq}, location =#{location}
		WHERE sseq=#{sseq} 
	</update>
	
	<!-- 내 수업 내역 -->
	<select id="mySubjectList" resultType="subject">
		SELECT s.name subname, p.name pname, s.time, d.name dname
		FROM subject s, professor p, department d ,register r
		WHERE r.sseq = s.sseq
			AND d.dseq = s.sseq
			AND p.id = s.id
			AND r.id = #{sid}
	</select>
</mapper>









